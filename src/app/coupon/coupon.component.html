<div class="search-container">
  <form>
    <div class="p-fluid p-formgrid p-grid">
      <div class="p-field p-col-12">
        <label for="query">Pesquisa</label>
        <input id="query" name="query" type="text" pInputText />
      </div>
    </div>
    <div class="p-fluid p-formgrid p-grid">
      <div class="p-field p-col-6">
        <button pButton type="submit" label="Pesquisar"></button>
        <button
          pButton
          type="submit"
          class="p-button-secondary"
          (click)="resetFilter()"
          label="Limpar Filtros"
        ></button>
      </div>
    </div>
  </form>
</div>
<div class="feature-header">
  <p>
    <label>Controle seus cupons de desconto.</label>
  </p>
  <div class="actions">
    <button title="Novo Cupom" pButton type="button" (click)="showDialog()" label="Novo Cupom"></button>
  </div>
</div>
<dgz-table
  #couponsTable
  [dataProvider]="this"
  [queryParams]="queryParams"
  (updateQueryParams)="updateQueryParams($event)"
  name="coupons-list"
>
  <thead>
    <tr>
      <th>Código</th>
      <th>Tipo</th>
      <th>Valor</th>
      <th>Ativo</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="centered"></td>
      <td class="centered"></td>
      <td class="centered"></td>
      <td class="centered"></td>
      <td class="actions">
        <button [title]="'Editar Cupom'" pButton type="button" label="Editar"></button>
      </td>
    </tr>
  </tbody>
</dgz-table>

<p-dialog
  header="Movimentação de Estoque"
  [(visible)]="isModalVisible"
  [dismissableMask]="true"
  [modal]="true"
  [resizable]="false"
  [draggable]="false"
  [contentStyle]="{ overflow: 'visible' }"
>
  <form nz-form [formGroup]="formFields" (ngSubmit)="submitCoupon()" *ngIf="isModalVisible">
    <div class="p-fluid p-formgrid p-grid">
      <div class="p-field p-col-6">
        <label for="code">Código</label>
        <input pInputText name="code" id="code" placeholder="Código do cupom ex: frida10%" formControlName="code" />
        <div *ngIf="formFields.getError('required', ['code']) && isFieldInvalid('code')">
          <small class="p-invalid">Insira o codigo do cupom</small>
        </div>
        <div class="p-invalid" *ngIf="formFields.getError('existingCode', ['code']) as error">
          <small>{{ error.message }}</small>
        </div>
      </div>
      <div class="p-field p-col-6">
        <label for="description">Descrição</label>
        <input
          pInputText
          name="description"
          id="description"
          placeholder="Descrição do cupom ex: 10% no total do carrinho"
          formControlName="description"
        />
        <small [hidden]="!isFieldInvalid('description')" id="description-help" style="color: #f44336;"
          >Insira a descrição do cupom</small
        >
      </div>
      <div class="p-field p-col-3">
        <label for="type">Tipo</label>
        <p-dropdown [options]="couponsTypes" formControlName="type"></p-dropdown>
      </div>
      <div class="p-field p-col-4">
        <label for="couponValue">Valor</label>
        <p-inputNumber
          formControlName="value"
          [min]="0"
          [max]="100"
          currency="BRL"
          mode="currency"
          locale="pt-BR"
          [minFractionDigits]="2"
          [maxFractionDigits]="2"
          placeholder="Valor do desconto do cupom ex: R$10,00 ou 10%"
        ></p-inputNumber>
        <div *ngIf="formFields.getError('required', ['value']) && isFieldInvalid('value')">
          <small class="p-invalid">Insira o valor do cupom</small>
        </div>
        <div class="p-invalid" *ngIf="formFields.getError('min', ['value']) as error">
          <small>O valor minimo do cupom não pode ser menor que 0.01</small>
        </div>
      </div>
      <div class="p-field p-col-4">
        <label for="expirationDate">Data de Expiração</label>
        <p-calendar name="startCalendarDate" formControlName="expirationDate" dateFormat="dd/mm/yy"></p-calendar>
        <small [hidden]="!isFieldInvalid('expirationDate')" id="expiration-date-help" style="color: #f44336;"
          >A data de expiração não pode ser anterior a data atual</small
        >
      </div>
      <div class="p-field p-col-1">
        <label for="active">Ativo</label>
        <p-inputSwitch id="active" name="active" formControlName="active"></p-inputSwitch>
      </div>
    </div>
  </form>
  <p-footer>
    <button pButton type="button" class="p-button-secondary" (click)="handleCancel()" label="Cancelar"></button>
    <button pButton type="button" label="Salvar"></button>
  </p-footer>
</p-dialog>
